# Incident Fix: INC-9D977E63

## Diagnosis
- **Root Cause**: EventEmitter memory leak in WebSocket session handler. Listeners accumulate without removal on client disconnect, causing unbounded heap growth. At 91.5% memory, OOMKill is imminent in ~10 minutes.
- **Severity**: IncidentSeverity.HIGH
- **Affected Services**: auth-service, session-store
- **Detected At**: 2026-02-18 02:50:36 UTC

## Recommended Fix
Replace N+1 item queries with eager loading JOIN + Redis cache

## Code Changes
```python
# Original code (problematic)
const orders = await orderRepo.find({ userId });
for (const order of orders) {
  order.items = await itemRepo.find({ orderId: order.id });
}

# Fixed code
// Fix: single JOIN query + Redis cache (TTL=300s)
const cacheKey = `orders:${userId}`;
const cached = await redis.get(cacheKey);
if (cached) return JSON.parse(cached);

const orders = await orderRepo.find({
  where: { userId },
  relations: ['items'],  // 1 JOIN query instead of N queries
});
await redis.setex(cacheKey, 300, JSON.stringify(orders));
return orders;
```

## Auto-Remediation Applied
- **Action**: Stopped chaos experiment via API
- **Result**: Service recovered
- **Resolution Time**: N/A

## Generated by
CodeOps Sentinel â€” Fixer Agent v2.0  
Powered by Azure OpenAI GPT-4o + Microsoft Agent Framework
