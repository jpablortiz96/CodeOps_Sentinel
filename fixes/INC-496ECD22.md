# Incident Fix: INC-496ECD22

## Diagnosis
- **Root Cause**: Kubernetes pod OOMKilled due to memory limit set to 512Mi — insufficient for peak buffer accumulation in the API gateway. Exit code 137 (SIGKILL) confirms kernel OOM intervention. CrashLoopBackOff restart count: 8.
- **Severity**: IncidentSeverity.CRITICAL
- **Affected Services**: api-gateway, k8s-cluster, all-downstream-services
- **Detected At**: 2026-02-16 12:22:11 UTC

## Recommended Fix
Replace N+1 item queries with eager loading JOIN + Redis cache

## Code Changes
```python
# Original code (problematic)
const orders = await orderRepo.find({ userId });
for (const order of orders) {
  order.items = await itemRepo.find({ orderId: order.id });
}

# Fixed code
// Fix: single JOIN query + Redis cache (TTL=300s)
const cacheKey = `orders:${userId}`;
const cached = await redis.get(cacheKey);
if (cached) return JSON.parse(cached);

const orders = await orderRepo.find({
  where: { userId },
  relations: ['items'],  // 1 JOIN query instead of N queries
});
await redis.setex(cacheKey, 300, JSON.stringify(orders));
return orders;
```

## Auto-Remediation Applied
- **Action**: Stopped chaos experiment via API
- **Result**: Service recovered
- **Resolution Time**: N/A

## Generated by
CodeOps Sentinel — Fixer Agent v2.0  
Powered by Azure OpenAI GPT-4o + Microsoft Agent Framework
